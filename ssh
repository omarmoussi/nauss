Mysql server preparation:
Installation mysql-server:
apt update
apt install mysql-server
Allow remote access to MySQL:
nano /etc/mysql/mysql.conf.d/mysqld.cnf
     Change line
      bind-address = 127.0.0.1  to #bind-address = 127.0.0.1 
Restart MySQL service:
service mysql restart
Create remote mysql user:
CREATE USER 'sabaya'@'10.164.0.3' IDENTIFIED BY 'password';
GRANT ALL ON *.* TO 'sabaya'@'10.164.0.3';
FLUSH PRIVILEGES;
Laravel server preparation:
Install php:
apt-get install software-properties-common -y
add-apt-repository ppa:ondrej/php
apt-get install -y php8.3-common php8.3-gmp php8.3-curl php8.3-soap php8.3-bcmath php8.3-intl php8.3-mbstring php8.3-xmlrpc php8.3-mysql php8.3-gd php8.3-xml php8.3-cli php8.3-zip php8.3-fpm
Install redis:
apt-get install -y redis
Install Composer
curl -sS https://getcomposer.org/installer -o composer-setup.php
sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer


Project deployment:
code source path: /var/www/html/sabayabackend
 update env file and runcommande;

composer update
php artisan clear-compiled
php artisan migrate --force
sudo php artisan cache:clear
php artisan route:clear
php artisan view:clear
php artisan config:clear
php artisan config:cache
update permission




######
rm -f /etc/apt/sources.list.d/ondrej-php.list
rm -f /usr/share/keyrings/ondrej-php.gpg

curl -fsSL "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x4F4EA0AAE5267A6C" \
| gpg --dearmor \
| sudo tee /usr/share/keyrings/ondrej-php.gpg > /dev/null

ls -l /usr/share/keyrings/ondrej-php.gpg


CODENAME=$(lsb_release -sc)

echo "deb [signed-by=/usr/share/keyrings/ondrej-php.gpg] \
https://ppa.launchpadcontent.net/ondrej/php/ubuntu \
$CODENAME main" \
| sudo tee /etc/apt/sources.list.d/ondrej-php.list


sudo apt update


sudo chown -R www-data:www-data /var/www/html/sabayabackend
sudo find  /var/www/html/sabayabackend -type f -exec chmod 664 {} \;   
sudo find  /var/www/html/sabayabackend -type d -exec chmod 775 {} \;
sudo chmod -R ug+rwx storage bootstrap/cache



curl -fsSL https://nginx.org/keys/nginx_signing.key | sudo gpg --dearmor -o /usr/share/keyrings/nginx-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] http://nginx.org/packages/ubuntu $(lsb_release -cs) nginx" | sudo tee /etc/apt/sources.list.d/nginx.list
sudo apt update
sudo apt install -y nginx



sudo apt-get install lsb-release curl gpg
curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg
sudo chmod 644 /usr/share/keyrings/redis-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/redis.list
sudo apt-get update
sudo apt-get install redis




# Exemple pour Ubuntu/Debian
wget https://repo.percona.com/apt/percona-release_latest.generic_all.deb
sudo dpkg -i percona-release_latest.generic_all.deb
sudo percona-release setup pxc80
sudo apt update
sudo apt install percona-xtradb-cluster



matser 
[mysqld]
server-id=2   
datadir=/var/lib/mysql
socket=/var/run/mysqld/mysqld.sock
log-error=/var/log/mysql/error.log
bind-address = 0.0.0.0
######## wsrep ###############
wsrep_provider=/usr/lib/libgalera_smm.so
pxc-encrypt-cluster-traffic=OFF
# Liste identique au Nœud 1
wsrep_cluster_address=gcomm://192.168.1.10,192.168.1.11,192.168.1.12

binlog_format=ROW
default_storage_engine=InnoDB
wsrep_slave_threads=8
innodb_autoinc_lock_mode=2

# IP locale de ce nœud
wsrep_node_address=192.168.1.11
wsrep_cluster_name=mon_cluster_percona
wsrep_node_name=node-2

pxc_strict_mode=ENFORCING
wsrep_sst_method=xtrabackup-v2



slave 
[mysqld]
server-id=1
datadir=/var/lib/mysql
socket=/var/run/mysqld/mysqld.sock
log-error=/var/log/mysql/error.log
pid-file=/var/run/mysqld/mysqld.pid
bind-address = 0.0.0.0

######## wsrep (Galera) ###############
wsrep_provider=/usr/lib/libgalera_smm.so
wsrep_cluster_name=mon_cluster_percona
wsrep_cluster_address=gcomm://192.168.1.10,192.168.1.11,192.168.1.12
wsrep_node_address=192.168.1.10
wsrep_node_name=node-1

binlog_format=ROW
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2

# Désactivation SSL pour résoudre l'erreur de certificat
pxc-encrypt-cluster-traffic=OFF
pxc_strict_mode=ENFORCING
wsrep_sst_method=xtrabackup-v2
https://eu.onetimesecret.com/secret/63hsxrrap968wcph6zl8jidj0zx6xu4
